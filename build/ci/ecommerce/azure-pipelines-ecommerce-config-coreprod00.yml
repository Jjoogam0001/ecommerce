trigger:
  branches:
    include:
    - master
  paths:
    include:
    - deployments/aks/config/coreprod00/*

pool:
  vmImage: ubuntu-latest
  
resources:
  repositories:
    - repository: templates
      type: git
      name: Martsoft-Coreecommerce/pipeline-templates

stages:
  - stage: deployconfig
    displayName: Deploy ecommerce Config
    condition: eq(variables['Build.SourceBranch'], 'refs/heads/master')
    jobs:
    - template: configmapfromfile/template.yml@templates
      parameters:
        environment: 'core-prod00'
        kubernetesServiceConnection: 'coreecommerce-to-core-prod00AKS'
        deployerEndpoint: 'Core-Dev-to-MartsoftbookACR'
        configPath: 'deployments/aks/config/coreprod00/config.yaml'
        configName: 'ecommerce'
        configMapName: 'ecommerce-ecommerce-config'